package com.roarmot.roarmot.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.nio.file.Paths;

/**
 * Configuraci√≥n para mapear rutas URL a recursos est√°ticos del sistema de archivos.
 * Esto es necesario para servir:
 * 1. Los archivos est√°ticos internos (CSS, JS, iconos) desde el classpath.
 * 2. Los archivos subidos por el usuario (im√°genes de productos) desde la ruta f√≠sica (file.upload-dir).
 */
@Configuration
public class WebConfig implements WebMvcConfigurer {

    private static final Logger logger = LoggerFactory.getLogger(WebConfig.class); 

    @Value("${file.upload-dir}")
    private String uploadDir;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        logger.info("üîç [WEBCONFIG] M√©todo ejecut√°ndose...");
        logger.info("üîç [WEBCONFIG] uploadDir = {}", uploadDir);

        // 1. Recursos est√°ticos
        registry.addResourceHandler("/**")
                .addResourceLocations("classpath:/static/");

        // 2. Im√°genes de productos
        registry.addResourceHandler("/products/**")
                .addResourceLocations("file:" + uploadDir + "/products/");

        // 3. Im√°genes de motos (NUEVO) - ¬°TE FALTA ESTA L√çNEA!
        File rutaBase = new File("data/uploads/motos");
        String rutaMotos = rutaBase.getAbsolutePath() + File.separator;
        registry.addResourceHandler("/motos/**")  // ‚Üê ¬°FALTABA ESTO!
                .addResourceLocations("file:" + rutaMotos.replace("\\", "/"));

        // 4. Im√°genes de perfil
        registry.addResourceHandler("/perfiles/**")
                .addResourceLocations("file:" + uploadDir + "/perfiles/");

        logger.info("üîç [WEBCONFIG] Ruta ABSOLUTA motos: {}", rutaMotos);
        logger.info("üîç [WEBCONFIG] Ruta formateada: {}", rutaMotos.replace("\\", "/"));
    }
}