<th:block th:fragment="content">
    <div th:if="${successMessage}" class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-2 sm:px-6 sm:py-3 rounded text-sm sm:text-base">
        <p th:text="${successMessage}"></p>
    </div>
    <div th:if="${errorMessage}" class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-2 sm:px-6 sm:py-3 rounded text-sm sm:text-base">
        <p th:text="${errorMessage}"></p>
    </div>
    
    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800 mb-6">Producto nuevo</h1>

    <form th:action="@{/panel/ProductProcess}" method="POST" enctype="multipart/form-data" class="flex flex-col md:flex-row gap-6" onsubmit="return validarFormulario()">
        <div class="bg-white p-6 sm:p-8 rounded-lg shadow w-full md:flex-1">
            <h2 class="text-base sm:text-lg font-semibold text-pink-600 mb-4">Datos generales</h2>

            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6 mb-6">
                <label class="flex items-center gap-2 text-sm sm:text-base">
                    <input type="radio" name="tipo" value="producto" class="accent-pink-600 w-4 h-4" checked />
                    <span>Un producto</span>
                </label>
                <label class="flex items-center gap-2 text-sm sm:text-base">
                    <input type="radio" name="tipo" value="combo" class="accent-pink-600 w-4 h-4" />
                    <span>En combo</span>
                </label>
                <label class="flex items-center gap-2 text-sm sm:text-base">
                    <input type="radio" name="tipo" value="servicio" class="accent-pink-600 w-4 h-4" />
                    <span>Servicio</span>
                </label>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <input type="text" name="nombre" placeholder="Nombre del producto *" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                <input type="text" name="marca" placeholder="Marca *" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                <select name="Talla" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                    <option value="XS">XS</option>
                    <option value="No aplica">No aplica</option>
                </select>
                <input type="number" name="cantidad" placeholder="Cantidad *" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                <input type="text" name="lote" placeholder="Lote" class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                <input type="number" name="precio_venta" placeholder="Precio de venta *" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
            </div>

            <textarea name="descripcion" placeholder="Descripción del producto" rows="3" class="w-full mb-6 p-2 sm:p-3 border border-gray-300 rounded focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base"></textarea>

            <h2 class="text-base sm:text-lg font-semibold text-pink-600 mb-2">Inventario</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                <select name="categoria" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                    <option value="">Categoría *</option>
                    <option value="casco">Cascos</option>
                    <option value="guantes">Guantes</option>
                    <option value="chaquetas">Chaquetas</option>
                </select>
                <select name="subcategoria" required class="p-2 sm:p-3 border rounded border-gray-300 focus:ring-2 focus:ring-pink-600 text-gray-800 text-sm sm:text-base">
                    <option value="">Subcategoría *</option>
                    <option value="integral">Integral</option>
                    <option value="modular">Modular</option>
                    <option value="abierto">Abierto</option>
                </select>
            </div>
        </div>

        <div class="w-full md:w-80 flex flex-col gap-4 flex-shrink-0">
            <div class="bg-white p-6 sm:p-8 rounded-lg shadow flex-1 flex flex-col justify-between">
                <label for="imagen" class="w-full h-48 sm:h-56 border border-dashed border-gray-400 flex flex-col items-center justify-center cursor-pointer text-gray-500 hover:text-pink-600 text-center text-sm sm:text-base mb-2">
                    <span class="text-3xl sm:text-4xl mb-2">+</span>
                    <span>Sube las fotos del producto</span>
                    <input type="file" name="imagen[]" id="imagen" class="hidden" accept="image/*" multiple onchange="previewImagenes(event)" required>
                </label>
                <div id="preview" class="grid grid-cols-4 gap-2 mt-4"></div>
            </div>
            <button type="submit" class="w-full bg-black text-white py-2 sm:py-3 rounded hover:bg-pink-600 transition text-base sm:text-lg font-semibold">Guardar</button>
        </div>
    </form>

    <script>
        function mostrarMensaje(mensaje, tipo) {
            const existingMessage = document.querySelector('.temp-message-container');
            if (existingMessage) {
                existingMessage.remove();
            }

            const container = document.createElement('div');
            let bgColor, borderColor, textColor;
            // ... (resto de la lógica de mostrarMensaje) ...
            switch (tipo) {
                case 'success':
                    bgColor = 'bg-green-100';
                    borderColor = 'border-green-400';
                    textColor = 'text-green-700';
                    break;
                case 'error':
                    bgColor = 'bg-red-100';
                    borderColor = 'border-red-400';
                    textColor = 'text-red-700';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-100';
                    borderColor = 'border-yellow-400';
                    textColor = 'text-yellow-700';
                    break;
                default:
                    bgColor = 'bg-blue-100';
                    borderColor = 'border-blue-400';
                    textColor = 'text-blue-700';
            }

            container.className = `temp-message-container fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg z-[1000] ${bgColor} ${borderColor} ${textColor} border w-11/12 sm:max-w-md`;
            container.innerHTML = `<p>${mensaje}</p>`;
            document.body.appendChild(container);

            setTimeout(() => {
                container.remove();
            }, 3000);
        }

        function validarFormulario() {
            const nombre = document.querySelector('[name="nombre"]').value.trim();
            const marca = document.querySelector('[name="marca"]').value.trim();
            const cantidad = document.querySelector('[name="cantidad"]').value.trim();
            const precio = document.querySelector('[name="precio_venta"]').value.trim();
            const categoria = document.querySelector('[name="categoria"]').value;
            const subcategoria = document.querySelector('[name="subcategoria"]').value;
            const imagenes = document.querySelector('[name="imagen[]"]').files;

            if (!nombre || !marca || !cantidad || !precio || !categoria || !subcategoria) {
                mostrarMensaje("Por favor, completa todos los campos obligatorios.", 'error');
                return false;
            }

            if (isNaN(cantidad) || parseInt(cantidad) < 0) {
                mostrarMensaje("La cantidad debe ser un número entero no negativo.", 'error');
                return false;
            }
            if (isNaN(precio) || parseFloat(precio) <= 0) {
                mostrarMensaje("El precio debe ser un número mayor que cero.", 'error');
                return false;
            }

            if (imagenes.length === 0) {
                mostrarMensaje(" Debes seleccionar al menos una imagen.", 'warning');
                return false;
            }

            return true;
        }

        function previewImagenes(event) {
            const preview = document.getElementById('preview');
            preview.innerHTML = '';
            
            if (event.target.files.length === 0) {
                preview.innerHTML = '';
                return;
            }

            Array.from(event.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'w-full h-auto object-cover rounded aspect-square';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</th:block>