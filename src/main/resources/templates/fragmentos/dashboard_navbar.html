<header th:fragment="navbar" class="bg-[#151921] shadow-md">
    <nav class="flex flex-col md:flex-row items-center justify-between p-2 sm:p-2 bg-[#151921] gap-2 md:gap-4">
        <div class="flex items-center space-x-0 rounded-lg transition transform hover:scale-110 ml-2 sm:ml-5">
            <img th:src="@{/imagenes/LogoBlanco.png}" alt="Logo RoarMot" class="h-10 sm:h-12">
            <img th:src="@{/imagenes/tipografiaLogo.png}" alt="RoarMot" class="h-6 sm:h-8">
        </div>
        
        <div class="flex flex-wrap justify-center items-center p-2 rounded-lg gap-1 md:gap-2">
            <button class="flex items-center px-2 py-1 sm:px-3 sm:py-2 hover:bg-gray-700 rounded-lg transition transform hover:scale-110 text-sm sm:text-base">
                <img th:src="@{imagenes/navbarImg/icoPanelControlBlanco.png}" alt="Panel" class="h-4 sm:h-5">
                <span class="hidden sm:inline ml-1">Panel de control</span>
            </button>
            <button class="flex items-center px-2 py-1 sm:px-3 sm:py-2 hover:bg-gray-700 rounded-lg transition transform hover:scale-110 text-sm sm:text-base">
                <img th:src="@{imagenes/navbarImg/icoCDABlanco.png}" alt="CDA" class="h-4 sm:h-5">
                <span class="hidden sm:inline ml-1">CDA</span>
            </button>
            <button class="flex items-center px-2 py-1 sm:px-3 sm:py-2 hover:bg-gray-700 rounded-lg transition transform hover:scale-110 text-sm sm:text-base">
                <img th:src="@{imagenes/navbarImg/alerta.png}" alt="Alertas" class="h-4 sm:h-5">
                <span class="hidden sm:inline ml-1">Alertas</span>
            </button>
            <button class="flex items-center px-2 py-1 sm:px-3 sm:py-2 hover:bg-gray-700 rounded-lg transition transform hover:scale-110 text-sm sm:text-base">
                <img th:src="@{imagenes/navbarImg/tiendaBlanco.png}" alt="Tienda" class="h-4 sm:h-5">
                <span class="hidden sm:inline ml-1">Tienda</span>
            </button>
            <button class="px-3 py-2 hover:bg-red-500 rounded-lg transition transform hover:scale-125 text-sm sm:text-base">
                <span class="sm:hidden">SOS</span>
                <span class="hidden sm:inline ">SOS</span>
            </button>
        </div>

        <div class="flex items-center gap-2 mr-2 sm:mr-5">
            <button class="sparkle-button bg-yellow-500 px-3 py-1 sm:px-4 sm:py-2 rounded-lg text-black hover:bg-[#D90D58] transition transform hover:scale-110 whitespace-nowrap relative overflow-hidden text-sm sm:text-base">
                Comprar accesorio
            </button>
            <button class="p-1 sm:p-2 hover:bg-gray-700 rounded-full transition transform hover:scale-125 ml-3">
                <img th:src="@{imagenes/navbarImg/universalidad.png}" alt="Idioma" class="h-4 w-4 sm:h-5 sm:w-5">
            </button>
            
            <div class="relative group">
                <button class="p-1 sm:p-2 hover:bg-gray-700 rounded-full transition transform hover:scale-125">
                    <img th:src="@{imagenes/navbarImg/icoConfiguracion.png}" alt="Configuración" class="h-4 w-4 sm:h-5 sm:w-5">
                </button>

                <div class="popup-form-window w-11/12 sm:w-96 lg:w-64 xl:w-[300px] left-1/2 -translate-x-1/2 md:left-auto md:right-0 mt-2">
                    <!-- El formulario que envuelve la sección de la imagen y la información del usuario -->
                    <form th:action="@{/actualizar-perfil}" method="post" enctype="multipart/form-data">
                        <div class="flex items-center p-3 sm:p-4 border-b border-[#5C7589]">
                            <!-- Este label es para el campo de subida de archivo -->
                            <label for="profileUpload" class="relative w-14 h-14 sm:w-16 sm:h-16 flex-shrink-0 cursor-pointer overflow-hidden rounded-lg border border-gray-600 flex items-center justify-center bg-gray-800">
                                <!-- Se usa th:src para mostrar dinámicamente la imagen del perfil o una por defecto -->
                                <img id="profilePreview" th:src="${usuario.urlImagenPerfil} ? @{/uploads/perfiles/{urlImagenPerfil}(urlImagenPerfil=${usuario.urlImagenPerfil})} : @{/uploads/default_avatar.png}" alt="Avatar de Usuario" class="w-full h-full object-cover">
                                <div id="profileUploadArea" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white opacity-0 hover:opacity-100 transition-opacity duration-200">
                                    <i class="fas fa-camera text-base sm:text-xl"></i>
                                </div>
                                <!-- El campo de entrada de archivo con el nombre "profileUpload" que el controlador espera -->
                                <input type="file" id="profileUpload" name="profileUpload" accept="image/*" class="hidden" onchange="this.form.submit()">
                            </label>
                            <div class="ml-3">
                                <p class="text-sm sm:text-base text-white font-semibold" th:text="${usuario.nombre} ?: 'Usuario'">Usuario</p>
                                <p class="text-xs sm:text-sm text-gray-400" th:text="${ofuscatedEmail}">correo@ejemplo.com</p>
                                <!-- Se muestra el rol del usuario -->
                                <span class="text-xs text-gray-500 mt-1 block" th:text="${usuario.rolId == 1 ? 'Vendedor' : (usuario.rolId == 2 ? 'Motero' : 'Rol')} + ' habitual'">Rol habitual</span>
                            </div>
                        </div>
                    </form>
                    <div class="p-3 sm:p-4 border-b border-[#5C7589]">
                        <p class="text-gray-300 text-sm font-semibold mb-2">Más opciones de configuración</p>
                    </div>
                    <a th:href="@{/panel}" 
                        th:if="${rol_nombre == 'Vendedor'}"
                        class="flex items-center px-3 py-2 sm:px-4 sm:py-3 text-gray-300 hover:bg-gray-700 transition rounded-b-lg text-sm sm:text-base">
                        <i class="fas fa-cog mr-2 sm:mr-3 text-base sm:text-lg"></i>
                        Panel Proveedor
                    </a>
                    <a href="#" class="flex items-center px-3 py-2 sm:px-4 sm:py-3 text-gray-300 hover:bg-gray-700 transition rounded-b-lg text-sm sm:text-base">
                        <i class="fas fa-cog mr-2 sm:mr-3 text-base sm:text-lg"></i>
                        Configuración de la cuenta
                    </a>
                    
                    <form th:action="@{/logout}" method="post" class="w-full">
                        <!-- El token CSRF es necesario para la petición POST -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        
                        <!-- El botón de submit toma los estilos del enlace anterior -->
                        <button type="submit" 
                            class="flex items-center w-full text-left px-3 py-2 sm:px-4 sm:py-3 text-red-500 hover:bg-gray-700 transition rounded-b-lg text-sm sm:text-base">
                            
                            <!-- Tu ícono original (asumiendo que estás usando Font Awesome para 'fas fa-sign-out-alt') -->
                            <i class="fas fa-sign-out-alt mr-2 sm:mr-3 text-base sm:text-lg"></i>
                            Cerrar Sesión
                        </button>
                    </form>

                </div>
            </div>
        </div>
    </nav>
</header>

<!-- Barra divisoria roja -->
    <div class="h-[1.2px] w-full bg-gradient-to-r from-transparent via-red-600 to-transparent shadow-lg shadow-red-600/10"></div>